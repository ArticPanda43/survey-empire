<%= form_with(model: question_answer, question: question, local: true) do |form| %>
  <div class="answer-question">
    <% if question_answer.errors.any? %>
      <div id="error_explanation">
        <h2><%= pluralize(question_answer.errors.count, "error") %> prohibited this question_answer from being saved:</h2>

        <ul>
        <% question_answer.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
        </ul>
      </div>
    <% end %>
    <% startTime = DateTime.now %>

    <h1><%= question.questionString %></h1>

    <div class="field">
      <%= form.hidden_field :question_id, value: question.id %>
      <%#= hidden_field_tag 'question_id', :question_id %>
    </div>

    <div class="field">
      <%= form.hidden_field :survey_id, value: question.survey_id %>
      <%#= hidden_field_tag 'survey_id', :survey_id %>
    </div>

    <div class="field">
      <%= form.hidden_field :user_id, value: current_user.id %>
      <%#= hidden_field_tag 'user_id', :user_id %>
    </div>

    <div class="field">
      <%= form.hidden_field :timeStarted, value: startTime %>
      <%#= hidden_field_tag 'timeStarted', startTime %>
    </div>

    <div class="field">
      <%= form.hidden_field :timeEnded %>
      <%#= hidden_field_tag 'timeEnded' %>
    </div>

    <% if question.multipleChoice == true then %>
      <%# Get question options %>
      <% questionOptions = QuestionOption.where(:question_id => question) %>
    <% end %>
    <% if question.multipleChoice == true && question.multipleAnswer == true then %>
      <%# List question options as tick boxes - user can select any number %>
      <div class="field">
        <% for questionOption in questionOptions.each %>
          <%= check_box_tag "question_answer[selectedOptions][]", questionOption.id %>
          <%= questionOption.optionString %>
        <% end %>
      </div>
    <% elsif question.multipleChoice == true then %>
      <%# List question options as radio buttons - user can select 1 %>
      <div class="field">
        <%= form.collection_radio_buttons(:selectedOption, questionOptions, :id, :optionString) %>
      </div>
    <% else %>
      <%# Question is single-answer, don't display options, just display a text box instead %>
      <div class="field">
        <%= form.label :givenAnswer %>
        <%= form.text_field :givenAnswer %>
      <div class="field">
    <% end %>

    <div class="actions">
      <%= form.submit %>
    </div>
  </div>
<% end %>
